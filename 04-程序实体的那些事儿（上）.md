# 04 | 程序实体的那些事儿（上）

Go 语言中的程序实体包括变量、常量、函数、结构体和接口。Go 语言是静态类型的编程语言，所以我们在声明变量或常量的时候都需要指定它们的类型，或者给予足够的信息以使 Go 语言能够推导出它们的类型。

在 Go 语言中，变量的类型可以是其预定义的那些类型，也可以是程序自定义的函数、结构体或接口。常量的合法类型不多，只能是那些 Go 语言预定义的基本类型。

## 问题：声明变量有几种方式？

1. 变量name的声明和对flag.StringVar函数的调用

    var name string
    flag.StringVar(&name, "name", "everyone", "The greeting object.")

2. 调用flag.String函数的代码左边加了一个*，这是因为该函数返回的结果值的类型是*string而不是string。类型*string代表的是字符串的指针类型，而不是字符串类型。

    var name = *flag.String("name", "everyone", "The greeting object.")

3. 短变量声明-- 基于第二种方式的代码，赋值符号=右边的代码不动，左边只留下name，再把=变成:=

    name := *flag.String("name", "everyone", "The greeting object.")

## 问题解析：

这个问题的基本考点有两个。
一个是你要知道 Go 语言中的类型推断，以及它在代码中的基本体现，
另一个是短变量声明的用法。

类型推断是一种编程语言在编译期自动解释表达式类型的能力。
什么是表达式？详细的解释你可以参看 Go 语言规范中的[表达式](https://golang.google.cn/ref/spec#Expressions)和[表达式语句](https://golang.google.cn/ref/spec#Expression_statements)章节

第3种方式所用的短变量声明，实际上就是 Go 语言的类型推断再加上一点点语法糖。我们只能在函数体内部使用短变量声明。在编写if、for或switch语句的时候，我们经常把它安插在初始化子句中，并用来声明一些临时的变量。而相比之下，第2种方式更加通用，它可以被用在任何地方。

## 知识扩展

1. Go 语言的类型推断可以带来哪些好处？

    Go 语言的类型推断可以明显提升程序的灵活性，**使得代码重构变得更加容易**，同时又不会给代码的维护带来额外负担（实际上，它恰恰可以避免散弹式的代码修改），更不会损失程序的运行效率。

2. 变量的重声明是什么意思？

这涉及了短变量声明。通过使用它，我们可以对同一个代码块中的变量进行重声明。

其含义是对已经声明过的变量再次声明。变量重声明的前提条件如下。

* 由于变量的类型在其初始化时就已经确定了，所以对它再次声明时赋予的类型必须与其原本的类型相同，否则会产生编译错误。
* 变量的重声明只可能发生在某一个代码块中。如果与当前的变量重名的是外层代码块中的变量，那么就是另外一种含义了，我在下一篇文章中会讲到。
* 变量的重声明只有在使用短变量声明时才会发生，否则也无法通过编译。如果要在此处声明全新的变量，那么就应该使用包含关键字var的声明语句，但是这时就不能与同一个代码块中的任何变量有重名了。
* 被“声明并赋值”的变量必须是多个，并且其中至少有一个是新的变量。这时我们才可以说对其中的旧变量进行了重声明。

我们使用关键字var和短变量声明都可以实现对变量的“声明并赋值”。

这两种方式各有千秋，有着各自的特点和适用场景。前者可以被用在任何地方，而后者只能被用在函数或者其他更小的代码块中。

## 思考题

如果与当前的变量重名的是外层代码块中的变量，那么这意味着什么？

一个程序实体的作用域总是会被限制在某个代码块中。而这个作用域最大的用处，就是对程序实体的访问权限的控制。对“高内聚，低耦合”这种程序设计思想的实践恰恰可以从这里开始。

程序实体的访问权限有三种：包级私有的、模块级私有的和公开的。
这其实就是 Go 语言在语言层面依据代码块对程序实体的作用域进行的定义。前两种访问权限对应的都是代码包代码块，最后一种访问权限对应的是全域代码块。